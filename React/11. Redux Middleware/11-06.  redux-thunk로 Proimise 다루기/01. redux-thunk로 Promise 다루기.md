# 01. redux-thunkë¡œ Promise ë‹¤ë£¨ê¸°
* `redux-thunk`ë¡œ í¬ìŠ¤íŠ¸ ë¦¬ìŠ¤íŠ¸ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì‘ì—… êµ¬í˜„ í›„ ë¦¬íŒ©í† ë§

## ğŸƒâ€â™€ï¸ redux-thunkì™€ Promise ì‘ì—… íë¦„
1. src/api/posts.jsì—ëŠ” 500ms í›„ì— `posts`ë¥¼ returní•˜ëŠ” `getPosts()`, `id`ì™€ ì¼ì¹˜í•˜ëŠ” `post`ë¥¼ returní•˜ëŠ” `getPost()` ì„ì‹œ apiê°€ ìˆìŒ
2. APIë¥¼ í˜¸ì¶œí•  ë•Œ ê°ê° `posts`ì™€ `post` ë§ˆë‹¤ `data`, `loading`, `error`ë¼ëŠ” ìƒíƒœ ê°ì²´ stateë¥¼ ë§Œë“¦
   1. FSA ê·œì¹™ : ëª¨ë“  `action`ì˜ ì¶”ê°€ì  ê°’ì„ `payload`ë¡œ, `loading` ë˜ëŠ” `error` ë°œìƒ ì‹œ `true`ë¡œ ì²˜ë¦¬
   2. util í•¨ìˆ˜ ë§Œë“¤ ë•Œ ìœ ìš©í•œ ê·œì¹™
 ```javascript
 /* state êµ¬ì¡° (ì´ˆê¸° ìƒíƒœ) */
 // í›„ì— dataëŠ” payloadë¡œ ì²˜ë¦¬

 posts: {
  data: null,
  loading: false,
  error: false
 }

 post: {
  data: null,
  loading: false,
  error: false
 }
 ```
 3. src/modules/posts.jsì—ì„œ `action.type`ê³¼ apië¥¼ ì¸ìë¡œ ë°›ëŠ” src/lib/asyncUtilsì˜ `createPromiseThunk()`ë¥¼ ì´ìš©í•´ ê° `action.type`ë§ˆë‹¤ dispatch í•˜ëŠ” í•¨ìˆ˜ `getPosts()`, `getPost()` ìƒì„±
 * **src/lib/asyncUtils.js**
 ```javascript
 export const createPromiseThunk = (type, promiseCreator) => {
  const [SUCCESS, ERROR] = [`${type}_SUCCESS`, `${type}_ERROR`];
  
  // thunk ìƒì„± í•¨ìˆ˜ : action ê°ì²´ë¡œ dispatchë¡œ action ê°ì²´ì— ì ‘ê·¼í•˜ëŠ” ë¶€ë¶„
  // paramê³¼ dispatchë¥¼ ëª¨ë‘ ê°€ì ¸ì˜´
 	return (param) => async (dispatch) => {
 		// params : { id, title } ê°™ì€ ê°ì²´. ëª¨ë“  paramsëŠ” í•˜ë‚˜ë¡œ í†µì¼í•œë‹¤ê³  ê°€ì •
 		dispatch({ type });
 		try {
	   const payload = await promiseCreator(param);
	   // payload : apiì—ì„œ returní•œ post, posts (stateì˜ data)
 			dispatch({
 				type: SUCCESS,
 				payload
 			});
 		} catch (e) {
 			dispatch({
 				type: ERROR,
 				payload: e,
 				error: true
 			}); // FSA ê·œì¹™
 		}
 	};
 };
 ```
* **src/modules/posts.js**
 ```javascript
 // thunk ìƒì„± í•¨ìˆ˜
 export const getPosts = createPromiseThunk(GET_POSTS, postAPI.getPosts);
 export const getPost = createPromiseThunk(GET_POST, postAPI.getPostById);
 ```
4. src/modules/posts.jsì—ì„œ `action.type`ê³¼ `key` (posts, post)ë¥¼ ì¸ìë¡œ ë°›ì•„ dispatchí•œ `action.type`ì— ë”°ë¼ stateë¥¼ returní•˜ëŠ” src/lib/asyncUtils.jsì˜ `handleAsyncActions()`ë¥¼ í†µí•´ ë¦¬ë“€ì„œ ìƒì„±
* **src/lib/asyncUtils.js**
  * `handleAsyncActions()`ëŠ” ë°˜ë³µë˜ëŠ” FSA êµ¬ì¡° state returnì„ `reducerUtils()`ë¥¼ í†µí•´ ìš”ì²­ ìƒíƒœë¥¼ ë¬¶ì–´ì„œ ê´€ë¦¬
 ```javascript
export const handleAsyncActions = (type, key) => {
	const [SUCCESS, ERROR] = [`${type}_SUCCESS`, `${type}_ERROR`];
	// key : post, posts, ë“±ë“± ë‹¤ì–‘í•œ ê°’

	// 3ê°€ì§€ ì•¡ì…˜ì— ëŒ€í•œ ë¦¬ë“€ì„œë¥¼ ì‘ì„±
	// => 1. typeì˜ loading 2. typeì˜ success 3. typeì˜ error
	return (state, action) => {
		switch (action.type) {
			case type:
				return {
					...state,
					[key]: reducerUtils.loading()
				};
			case SUCCESS:
				return {
					...state,
					[key]: reducerUtils.success(action.payload)
				};
			case ERROR:
				return {
					...state,
					[key]: reducerUtils.error(action.error)
				};
			default:
				return state;
		}
	};
}; // ì ‘ê·¼ì— ë”°ë¼ redux state return

export const reducerUtils = {
	initial: (data = null) => ({
		data,
		loading: false,
		error: null
	}),
	loading: (prevState = null) => ({
		data: prevState,
		loading: true,
		error: null
	}),
	success: (data) => ({
		data: data,
		loading: false,
		error: null
	}),
	error: (error) => ({
		data: null,
		loading: false,
		error: error
	})
};
// ê° ì•¡ì…˜ë§ˆë‹¤ ë°˜ë³µë˜ëŠ” ìš”ì²­ ìƒíƒœë¥¼ í•¨ìˆ˜ë¡œ ë¬¶ì–´ì„œ ê´€ë¦¬
 ```
 * **src/modules/posts.js**
 ```javascript
 // state return ì œì–´ ë¦¬ë“€ì„œ ë°˜í™˜
const getPostsReducer = handleAsyncActions(GET_POSTS, "posts");
const getPostReducer = handleAsyncActions(GET_POST, "post");
 ```
5. ìµœì¢…ì ìœ¼ë¡œ í¬ìŠ¤íŠ¸ ë¦¬ìŠ¤íŠ¸ì™€ í¬ìŠ¤íŠ¸ë¥¼ ê´€ë¦¬í•˜ëŠ” ë¦¬ë“€ì„œ ìƒì„± -> dispatchí•œ `action.type`ì— ë”°ë¼ state return
* **src/modules/posts.js**
```javascript
export default function posts(state = initState, action) {
	switch (action.type) {
		case GET_POSTS:
		case GET_POSTS_SUCCESS:
		case GET_POSTS_ERROR:
			return getPostsReducer(state, action);

		case GET_POST:
		case GET_POST_SUCCESS:
		case GET_POST_ERROR:
			return getPostReducer(state, action);

		default:
			return state;
	}
}
```

## ğŸ” í”„ë ˆì  í…Œì´ì…”ë„ ì»´í¬ë„ŒíŠ¸ ì‘ì„±
1. í˜ì´ì§€ê°€ ì²˜ìŒ ë¡œë”©ë  ë•Œ í¬ìŠ¤íŠ¸ ë¦¬ìŠ¤íŠ¸ë¥¼ ë¶ˆëŸ¬ì˜¤ê³  ì¶œë ¥í•˜ëŠ” ì»´í¬ë„ŒíŠ¸ ì‘ì„±
   * ìš”ì²­ ìƒíƒœì— ë”°ë¼ ë‹¤ë¥¸ í™”ë©´ í‘œì‹œ
* **src/containers/PostListContainer.js**
```javascript
import React, { useEffect } from "react";
import { useSelector, useDispatch } from "react-redux";
import PostList from "../components/PostList";
import { getPosts } from "../modules/posts";

export default function PostListContainer() {
	const { data, loading, error } = useSelector((state) => state.posts.posts);
	const dispatch = useDispatch();

	useEffect(() => {
		dispatch(getPosts()); // ê¼­ í˜¸ì¶œë¡œ!
	}, [dispatch]);

	if (loading) return <div>ë¡œë”©ì¤‘...</div>;
	if (error) return <div>ì—ëŸ¬ ë°œìƒ!</div>;
	if (!data) return null;

	return <PostList posts={data} />;
}
```
* **src/components/PostList.js**
```javascript
import React from "react";

export default function PostList({ posts }) {
	return (
		<div>
			<ul>
				{posts.map((post) => (
					<li key={post.id}>{post.title}</li>
				))}
			</ul>
		</div>
	);
}
```

## âœ ì •ë¦¬
* `redux-thunk`ë¡œ Promiseë¥¼ ì‚¬ìš©í•˜ë©´ API ìš”ì²­ê³¼ ê°™ì€ ì‘ì—…ì„ ìƒíƒœë¡œ ê´€ë¦¬í•  ìˆ˜ ìˆìŒ
* ë¬´ì¡°ê±´ ì²˜ìŒë¶€í„° ê³¼ë„í•œ ë¦¬íŒ©í† ë§ì„ í•  í•„ìš”ëŠ” ì—†ìŒ -> êµ¬í˜„ ì‹œ ë°˜ë³µë˜ëŠ” ì½”ë“œê°€ ë§ë‹¤ê±°ë‚˜ í•  ë•Œ í•„ìš”í•œ ë¶€ë¶„ì„ í•˜ë‚˜ì”© ë¦¬íŒ©í† ë§ í•˜ëŠ” ê²ƒì„ ì¶”ì²œ

## ğŸ”— ì°¸ê³ 
* [ë²¨ë¡œí¼íŠ¸ì™€ í•¨ê»˜í•˜ëŠ” ëª¨ë˜ ë¦¬ì•¡íŠ¸ íŠœí† ë¦¬ì–¼ ë¬¸ì„œ - redux-thunkë¡œ í”„ë¡œë¯¸ìŠ¤ ë‹¤ë£¨ê¸°](https://react.vlpt.us/redux-middleware/05-redux-thunk-with-promise.html)

