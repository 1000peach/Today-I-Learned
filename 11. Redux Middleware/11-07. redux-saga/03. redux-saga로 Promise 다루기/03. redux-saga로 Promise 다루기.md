# 03. redux-sagaë¡œ Promise ë‹¤ë£¨ê¸°

* sagaëŠ” ìˆœìˆ˜ actionì„ dispatchí•˜ëŠ” í˜•íƒœë¡œ ë¹„ë™ê¸° ì‘ì—…ì„ ì²˜ë¦¬í•  ìˆ˜ ìˆìŒ

1. thunkëŠ” ë¹„ë™ê¸° ì‘ì—…ì„ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ thunk creator functionì„ ì‚¬ìš©
   * ì‚¬ìš© ì‹œ thunk functionì„ dispatch
2. sagaëŠ” ìˆœìˆ˜ action ìƒì„± functionì„ ë§Œë“¤ê³ , í•´ë‹¹ actionì´ dispatchë˜ë©´ íŠ¹ì • ë¡œì§ì„ sagaì—ì„œ ìˆ˜í–‰í•¨
   * ìˆœìˆ˜ action function: typeì„ ì§€ë‹ˆê³  ìˆëŠ” ê°ì²´ return `const getPost = id => ({type: GET_POST, payload: id, meta: id});`
3. promiseë¥¼ ë‹¤ë£° ë•Œ ì‚¬ìš©í•˜ëŠ” saga effects
   * `yield call(function, param)` : functionì„ paramë¥¼ ì‚¬ìš©í•´ì„œ í˜¸ì¶œí•¨. functionì´ promiseë¥¼ ë°˜í™˜í•œë‹¤ë©´, promiseê°€ ëë‚  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦¬ë‹¤ê°€ resolve ê²°ê³¼ë¥¼ ë°˜í™˜í•¨. ê·¸ í›„ ë‹¤ìŒì„ ë¼ì¸ ì‹¤í–‰
   * `try-catch`ì™€ ì¡°í•©í•´ì„œ ì—ëŸ¬ í•¸ë“¤ë§
4. thunkì—ì„œëŠ” í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•´ actionì„ ì‹¤í–‰ì‹œí‚¤ê³ , sagaëŠ” ì²˜ìŒ actionì— ì˜í•´ í˜¸ì¶œ (-> reducer actionê³¼ ì¤‘ë³µ ê°€ëŠ¥) 

## ğŸ‘©â€ğŸ’» ì˜ˆì œ ì½”ë“œ

> api í˜¸ì¶œ í›„ promise ì„±ê³µ ì—¬ë¶€ì— ë”°ë¼ ë‹¤ë¥¸ actionì„ dispatchí•˜ëŠ” saga ì˜ˆì œ

* **src/modules/posts.js** ì¤‘ ì¼ë¶€
```javascript
import * as postAPI from "../api/posts";
import { call, put, takeEvery } from "redux-saga/effects";

/* import, action ë“± ë³´ì¼ëŸ¬ í”Œë ˆì´íŠ¸ ê³¼ì • ìƒëµ.. */

export const getPosts = () => ({ type: GET_POSTS });
export const getPost = (id) => ({
  type: GET_POST,
  payload: id,
  meta: id
}); // saga (+reducer) í˜¸ì¶œ action

function* getPostsSaga() {
  try {
    const posts = yield call(postAPI.getPosts); // promise ë°˜í™˜ -> ëë‚  ë•Œ ê¹Œì§€ ê¸°ë‹¤ë ¸ë‹¤ê°€ postsì— ê²°ê³¼ data ë°˜í™˜
    
    yield put({
      type: GET_POSTS_SUCCESS,
      payload: posts
    }); // ì„±ê³µ action dispatch
  } catch (err) {
    yield put({
      type: GET_POSTS_ERROR,
      payload: err,
      error: true
    }); // ì‹¤íŒ¨ action dispatch
  }
}

function* getPostSaga(action) {
  const id = action.payload;

  try {
    const post = yield call(postAPI.getPostById, id); // idë¥¼ ì‚¬ìš©í•˜ì—¬ postAPI.getPostById promise í˜¸ì¶œ

    yield put({
      type: GET_POSTS_SUCCESS,
      payload: post,
      meta: id
    });
  } catch (err) {
    yield put({
      type: GET_POST_ERROR,
      payload: err,
      error: true,
      meta: id
    });
  }
}

// saga ëª¨ë‹ˆí„°ë§ í•¨ìˆ˜ -> actionì´ ë°œìƒí•˜ë©´ saga ì‹¤í–‰í•˜ë„ë¡ ë“±ë¡
export function* postsSaga() {
  yield takeEvery(GET_POSTS, getPostsSaga);
  yield takeEvery(GET_POST, getPostSaga);
}

/* ì´í•˜ store state, reducer ì‘ì—… ìƒëµ.. */
```

## ğŸ”— ì°¸ê³ 

* [11-06-01. redux-thunkë¡œ Promise ë‹¤ë£¨ê¸° : promise ë¶€ë¶„ì„ thunkì—ì„œ sagaë¡œ ëŒ€ì²´](https://github.com/1000peach/React-Study/blob/master/11.%20Redux%20Middleware/11-06.%20%20redux-thunk%EB%A1%9C%20Proimise%20%EB%8B%A4%EB%A3%A8%EA%B8%B0/01.%20redux-thunk%EB%A1%9C%20Promise%20%EB%8B%A4%EB%A3%A8%EA%B8%B0.md)